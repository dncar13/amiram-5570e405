#!/bin/bash

# AMIRAM Enhanced Generator - Quick Run Script
# ============================================

echo "ğŸš€ AMIRAM Enhanced Generator v2.0"
echo "================================="
echo ""

# Check if node is installed
if ! command -v node &> /dev/null; then
    echo "âŒ Node.js is not installed. Please install Node.js 18+"
    exit 1
fi

# Check if .env exists
if [ ! -f .env ]; then
    echo "âŒ .env file not found!"
    echo "Creating .env template..."
    echo "ANTHROPIC_API_KEY=your_key_here" > .env
    echo "âš ï¸  Please add your API key to .env file"
    exit 1
fi

# Check if API key is set
if grep -q "your_key_here" .env; then
    echo "âŒ Please update your API key in .env file"
    exit 1
fi

# Create necessary directories
mkdir -p output logs types

# Check if types file exists
if [ ! -f types/questionTypes.ts ]; then
    echo "âš ï¸  types/questionTypes.ts not found!"
    echo "Please add the types file from the instructions"
    exit 1
fi

# Install dependencies if needed
if [ ! -d node_modules ]; then
    echo "ğŸ“¦ Installing dependencies..."
    npm install
fi

# Main menu
echo "Choose an option:"
echo "1) Generate new templates with placeholders"
echo "2) Fill existing templates with AI content"
echo "3) Validate generated files"
echo "4) Clean output directory"
echo "5) Run full pipeline (templates + fill)"
echo ""
read -p "Enter choice [1-5]: " choice

case $choice in
    1)
        echo "ğŸ“ Generating templates..."
        npx tsx template-generator.ts
        ;;
    2)
        echo "ğŸ¤– Filling templates with AI content..."
        npx tsx amiram-generator.ts
        ;;
    3)
        echo "ğŸ” Validating files..."
        npx tsx validator.ts
        ;;
    4)
        echo "ğŸ§¹ Cleaning output directory..."
        rm -rf output/*.ts output/*.json
        echo "âœ… Cleaned!"
        ;;
    5)
        echo "ğŸ¯ Running full pipeline..."
        npx tsx template-generator.ts
        sleep 2
        npx tsx amiram-generator.ts
        sleep 2
        npx tsx validator.ts
        ;;
    *)
        echo "âŒ Invalid choice"
        exit 1
        ;;
esac

echo ""
echo "âœ… Done!"